---

 
    - hosts: 35.180.98.141
      gather_facts: no
      user: ubuntu
      connection: "ssh"
      become: true

    - name: Install Python 3 and Docker Compose
      hosts: all
      become: true
      tasks:
      - name: update 
        command: apt-get update
        become: true
        ignore_errors: yes
      # - name: Update package manager
      #   apt:
      #     update_cache: true
      - name: install essentials
        command: sudo apt-get install -y build-essential libsqlite3-dev sqlite3 bzip2 libbz2-dev zlib1g-dev libssl-dev openssl libgdbm-dev libgdbm-compat-dev liblzma-dev libreadline-dev libncursesw5-dev libffi-dev uuid-dev
        ignore_errors: yes
      - name: Install Python 3
        apt:
          name: python3
          state: present
      - name: Install pip
        apt:
          name: python3-pip
          state: present
      - name: Install Docker Compose
        pip:
          name: docker-compose
          state: present
      - name: Add Docker s official GPG key
        remote_user: ubuntu
        apt_key:
          url: https://download.docker.com/linux/ubuntu/gpg
          state: present
        tags:
          - docker
              
      - name: Verify that we have the key with the fingerprint
        remote_user: ubuntu
        apt_key:
          id: 0EBFCD88
          state: present
        tags:
          - docker          
      - name: Set up the stable repository
        remote_user: ubuntu
        apt_repository:
          repo: deb [arch=amd64] https://download.docker.com/linux/ubuntu xenial stable
          state: present
          update_cache: yes
        tags:
          - docker          
      - name: Install docker
        remote_user: ubuntu
        apt:
          name: docker-ce
          state: present
          update_cache: yes
      - name: Add remote "ubuntu" user to "docker" group
        remote_user: ubuntu
        user:
          name: "ubuntu"
          group: "docker"
          append: yes
